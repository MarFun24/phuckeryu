<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>University of Phuckery - Degree Customizer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Inter', Helvetica, Arial, sans-serif; }
    .style-btn.active { background: #01538B !important; color: white !important; border-color: #01538B !important; }
    
    /* Preview States */
    .preview-container {
      aspect-ratio: 1000 / 775;
      background: #f3f4f6;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      position: relative;
    }
    .preview-placeholder {
      text-align: center;
      padding: 40px;
    }
    .preview-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    
    /* Loading Spinner */
    .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid #e5e7eb;
      border-top-color: #01538B;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Preview Button States */
    .preview-btn {
      position: relative;
      overflow: hidden;
    }
    .preview-btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }
    .preview-btn.loading .btn-text {
      visibility: hidden;
    }
    .preview-btn.loading::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      top: 50%;
      left: 50%;
      margin-left: -10px;
      margin-top: -10px;
      border: 2px solid transparent;
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    /* Dirty State Indicator */
    .form-dirty .preview-stale-badge {
      display: flex;
    }
    .preview-stale-badge {
      display: none;
      position: absolute;
      top: 12px;
      right: 12px;
      background: #f59e0b;
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      align-items: center;
      gap: 6px;
      z-index: 10;
    }
    
    /* Mock Stripe Checkout Styles */
    .stripe-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    .stripe-modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    .stripe-checkout {
      background: #fff;
      width: 100%;
      max-width: 450px;
      border-radius: 12px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
      overflow: hidden;
      transform: scale(0.95) translateY(20px);
      transition: all 0.3s ease;
    }
    .stripe-modal-overlay.active .stripe-checkout {
      transform: scale(1) translateY(0);
    }
    .stripe-header {
      background: linear-gradient(135deg, #635bff 0%, #7a73ff 100%);
      padding: 24px;
      color: white;
    }
    .stripe-input {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      font-size: 16px;
      transition: all 0.2s;
      background: #fff;
    }
    .stripe-input:focus {
      outline: none;
      border-color: #635bff;
      box-shadow: 0 0 0 3px rgba(99, 91, 255, 0.1);
    }
    .stripe-btn {
      width: 100%;
      padding: 14px;
      background: #635bff;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .stripe-btn:hover {
      background: #4f46e5;
    }
    .stripe-btn:disabled {
      background: #a5b4fc;
      cursor: not-allowed;
    }
    .stripe-btn.processing::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      top: 50%;
      left: 50%;
      margin-left: -10px;
      margin-top: -10px;
      border: 2px solid transparent;
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    .card-element { position: relative; }
    .card-icons {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      gap: 4px;
    }
    .card-icon {
      width: 32px;
      height: 20px;
      background: #f3f4f6;
      border-radius: 3px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: bold;
      color: #6b7280;
    }
    .success-state { text-align: center; padding: 40px 24px; }
    .success-checkmark {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 24px;
      animation: scaleIn 0.4s ease;
    }
    @keyframes scaleIn {
      0% { transform: scale(0); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    .demo-banner {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border: 2px dashed #f59e0b;
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .demo-banner-icon {
      background: #f59e0b;
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
      flex-shrink: 0;
    }
  </style>
</head>
<body style="background-color: #EAEAEE; min-height: 100vh;">
  
  <header style="background: linear-gradient(135deg, #01538B 0%, #023a61 100%); padding: 1.5rem 2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.2);">
    <div class="max-w-[1800px] mx-auto">
      <h1 class="text-2xl md:text-3xl font-bold text-white tracking-wide">University of Phuckery</h1>
      <p class="text-sm text-blue-100 mt-1 opacity-90">Customize Your Prestigious Degree</p>
    </div>
  </header>

  <div class="max-w-[1800px] mx-auto p-4 md:p-8">
    <div class="flex flex-col lg:flex-row gap-6 items-start">
      
      <!-- LEFT PANEL: Form Controls -->
      <div class="w-full lg:w-[420px] flex-shrink-0 bg-white rounded-xl shadow-xl p-5 md:p-6 lg:sticky lg:top-4 border border-gray-100">
        <h2 class="text-lg md:text-xl font-bold mb-4" style="color: #3A3C3E;">Degree Details</h2>
        
        <div class="space-y-3" id="diplomaForm">
          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="block text-xs font-semibold mb-1.5" style="color: #3A3C3E;">First Name</label>
              <input type="text" id="firstName" value="Your Name" class="form-input w-full px-3 py-2 text-sm border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-200 focus:border-blue-400 transition-all">
            </div>
            <div>
              <label class="block text-xs font-semibold mb-1.5" style="color: #3A3C3E;">Last Name</label>
              <input type="text" id="lastName" value="Here" class="form-input w-full px-3 py-2 text-sm border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-200 focus:border-blue-400 transition-all">
            </div>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="block text-xs font-semibold mb-1.5" style="color: #3A3C3E;">Degree Level</label>
              <select id="degreeLevel" class="form-input w-full px-3 py-2 text-sm border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-200 focus:border-blue-400 transition-all bg-white">
                <option value="Bachelor">Bachelor</option>
                <option value="Master" selected>Master</option>
                <option value="PhD">PhD</option>
              </select>
            </div>
            <div>
              <label class="block text-xs font-semibold mb-1.5" style="color: #3A3C3E;">Faculty</label>
              <select id="faculty" class="form-input w-full px-3 py-2 text-sm border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-200 focus:border-blue-400 transition-all bg-white">
                <option value="Petty">Petty</option>
                <option value="Minding Your Own Business">Minding Your Own Business</option>
                <option value="Common Sense">Common Sense</option>
                <option value="Not Giving a F*ck">Not Giving a F*ck</option>
                <option value="Sarcasm">Sarcasm</option>
                <option value="Adulting">Adulting</option>
                <option value="Procrastination">Procrastination</option>
                <option value="Overthinking">Overthinking</option>
                <option value="Social Media Stalking">Social Media Stalking</option>
                <option value="Netflix Binging">Netflix Binging</option>
                <option value="Online Shopping">Online Shopping</option>
                <option value="Napping">Napping</option>
              </select>
            </div>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1.5" style="color: #3A3C3E;">Achievement Description</label>
            <select id="achievementSelect" class="form-input w-full px-3 py-2 text-sm border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-200 focus:border-blue-400 transition-all bg-white mb-2">
              <option value="exemplary performance in the art of subtle comebacks and graceful revenge">üéØ Subtle comebacks & graceful revenge</option>
              <option value="mastering the ancient art of looking unbothered while internally screaming">üòå Looking unbothered while screaming inside</option>
              <option value="outstanding achievement in minding their own damn business">üôà Minding their own damn business</option>
              <option value="exceptional skills in reading the room and choosing chaos anyway">üî• Reading the room, choosing chaos</option>
              <option value="advanced proficiency in saying 'per my last email' with devastating effect">üìß Weaponizing 'per my last email'</option>
              <option value="achieving zen-level detachment from other people's drama">üßò Zen-level drama detachment</option>
              <option value="fluency in strategic silence and perfectly timed exits">üö™ Strategic silence & perfect exits</option>
              <option value="successfully adulting for 72 consecutive hours without incident">üèÜ 72 hours of successful adulting</option>
              <option value="completing tasks at the absolute last possible moment with excellence">‚è∞ Last-minute excellence</option>
              <option value="maintaining composure while everything was literally on fire">üî• Composure amid chaos</option>
              <option value="finding information that was absolutely none of their business">üîç Expert-level info gathering</option>
              <option value="perfecting the art of nodding thoughtfully while thinking about dinner">üçï Thoughtful nodding (thinking about food)</option>
              <option value="custom">‚úèÔ∏è Write your own...</option>
            </select>
            <textarea id="achievementCustom" rows="2" class="form-input w-full px-3 py-2 text-sm border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-200 focus:border-blue-400 transition-all resize-none hidden" placeholder="Write your custom achievement..."></textarea>
          </div>

          <div class="pt-3 border-t border-gray-200">
            <label class="block text-xs font-semibold mb-2" style="color: #3A3C3E;">Choose Your Package</label>
            <div class="space-y-2" id="priceTiers">
              <label class="flex items-center p-3 rounded-lg border-2 border-gray-200 cursor-pointer hover:border-blue-300 transition-all has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50">
                <input type="radio" name="priceTier" value="digital" data-price="19.99" data-label="Digital Download" class="mr-3 accent-blue-600" checked>
                <div class="flex-1">
                  <div class="font-semibold text-sm" style="color: #3A3C3E;">Digital Download</div>
                  <div class="text-xs text-gray-500">High-res PDF delivered via email</div>
                </div>
                <div class="font-bold text-blue-600">$19.99</div>
              </label>
              <label class="flex items-center p-3 rounded-lg border-2 border-gray-200 cursor-pointer hover:border-blue-300 transition-all has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50">
                <input type="radio" name="priceTier" value="printed" data-price="39.99" data-label="Printed Diploma" class="mr-3 accent-blue-600">
                <div class="flex-1">
                  <div class="font-semibold text-sm" style="color: #3A3C3E;">Printed Diploma</div>
                  <div class="text-xs text-gray-500">Premium cardstock, shipped to you</div>
                </div>
                <div class="font-bold text-blue-600">$39.99</div>
              </label>
              <label class="flex items-center p-3 rounded-lg border-2 border-gray-200 cursor-pointer hover:border-blue-300 transition-all has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50">
                <input type="radio" name="priceTier" value="framed" data-price="79.99" data-label="Printed & Framed" class="mr-3 accent-blue-600">
                <div class="flex-1">
                  <div class="font-semibold text-sm" style="color: #3A3C3E;">Printed & Framed</div>
                  <div class="text-xs text-gray-500">Ready to hang, museum-quality frame</div>
                </div>
                <div class="font-bold text-blue-600">$79.99</div>
              </label>
            </div>
          </div>

          <div class="pt-3 border-t border-gray-200">
            <label class="block text-xs font-semibold mb-2" style="color: #3A3C3E;">What's Your Vibe?</label>
            <div class="grid grid-cols-3 gap-2" id="styleButtons">
              <button type="button" data-style="classic" data-page="1" class="style-btn active p-2.5 rounded-lg border-2 text-xs font-medium transition-all">
                <div class="text-lg mb-1">üéì</div>
                <div class="text-[10px] leading-tight">Classic Academia</div>
              </button>
              <button type="button" data-style="boujie" data-page="2" class="style-btn p-2.5 rounded-lg border-2 border-gray-200 bg-white text-gray-600 hover:border-gray-400 transition-all">
                <div class="text-lg mb-1">‚ú®</div>
                <div class="text-[10px] leading-tight">Boujie & Luxe</div>
              </button>
              <button type="button" data-style="legal" data-page="3" class="style-btn p-2.5 rounded-lg border-2 border-gray-200 bg-white text-gray-600 hover:border-gray-400 transition-all">
                <div class="text-lg mb-1">‚öñÔ∏è</div>
                <div class="text-[10px] leading-tight">Law School</div>
              </button>
              <button type="button" data-style="medical" data-page="4" class="style-btn p-2.5 rounded-lg border-2 border-gray-200 bg-white text-gray-600 hover:border-gray-400 transition-all">
                <div class="text-lg mb-1">üè•</div>
                <div class="text-[10px] leading-tight">Medical</div>
              </button>
              <button type="button" data-style="creative" data-page="5" class="style-btn p-2.5 rounded-lg border-2 border-gray-200 bg-white text-gray-600 hover:border-gray-400 transition-all">
                <div class="text-lg mb-1">üé®</div>
                <div class="text-[10px] leading-tight">Creatives</div>
              </button>
              <button type="button" data-style="tech" data-page="6" class="style-btn p-2.5 rounded-lg border-2 border-gray-200 bg-white text-gray-600 hover:border-gray-400 transition-all">
                <div class="text-lg mb-1">ü§ñ</div>
                <div class="text-[10px] leading-tight">AI / Tech</div>
              </button>
              <button type="button" data-style="kids" data-page="7" class="style-btn p-2.5 rounded-lg border-2 border-gray-200 bg-white text-gray-600 hover:border-gray-400 transition-all col-span-3">
                <div class="text-lg mb-1">ü¶•</div>
                <div class="text-[10px] leading-tight">Lil Phuckers (Digital Only)</div>
              </button>
            </div>
          </div>

          <!-- PREVIEW BUTTON -->
          <button id="previewBtn" class="preview-btn w-full font-bold py-3 px-4 text-sm rounded-lg transition-all duration-200 mt-3 text-white hover:opacity-90 shadow-lg bg-gradient-to-r from-emerald-500 to-emerald-600">
            <span class="btn-text">üîç Generate Preview</span>
          </button>
          
          <!-- PURCHASE BUTTON -->
          <button id="checkoutBtn" class="w-full font-bold py-3 px-4 text-sm rounded-lg transition-all duration-200 text-white hover:opacity-90 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed" style="background: linear-gradient(135deg, #01538B 0%, #023a61 100%);" disabled>
            Purchase for $19.99
          </button>
          <p id="checkoutError" class="text-red-500 text-xs mt-2 hidden"></p>
          <p id="previewHint" class="text-gray-500 text-xs mt-2 text-center">Generate a preview before purchasing</p>
        </div>
      </div>

      <!-- RIGHT PANEL: Preview Display -->
      <div class="w-full flex-grow bg-white rounded-xl shadow-xl p-5 md:p-6 border border-gray-100">
        <h2 class="text-xl md:text-2xl font-bold mb-6" style="color: #3A3C3E;">Preview</h2>
        
        <div class="preview-container" id="previewContainer">
          <!-- Stale badge (shown when form changes after preview) -->
          <div class="preview-stale-badge">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            </svg>
            Preview outdated - click to regenerate
          </div>
          
          <!-- Empty State -->
          <div class="preview-placeholder" id="previewEmpty">
            <div class="text-6xl mb-4">üéì</div>
            <h3 class="text-lg font-semibold text-gray-700 mb-2">Your diploma preview will appear here</h3>
            <p class="text-sm text-gray-500">Fill in your details and click "Generate Preview"</p>
          </div>
          
          <!-- Loading State -->
          <div class="preview-placeholder hidden" id="previewLoading">
            <div class="spinner mb-4"></div>
            <h3 class="text-lg font-semibold text-gray-700 mb-2">Generating your diploma...</h3>
            <p class="text-sm text-gray-500">This usually takes 2-5 seconds</p>
          </div>
          
          <!-- Preview Image -->
          <img id="previewImage" class="preview-image hidden" alt="Diploma Preview">
          
          <!-- Error State -->
          <div class="preview-placeholder hidden" id="previewError">
            <div class="text-6xl mb-4">üòï</div>
            <h3 class="text-lg font-semibold text-gray-700 mb-2">Something went wrong</h3>
            <p class="text-sm text-gray-500 mb-4" id="previewErrorMessage">Please try again</p>
            <button onclick="generatePreview()" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700">
              Try Again
            </button>
          </div>
        </div>
        
        <p class="text-xs text-center mt-4" style="color:#3A3C3E;opacity:0.6;">
          Preview generated from Canva. Final output will be high-resolution.
        </p>
      </div>
    </div>
  </div>

  <!-- Mock Stripe Checkout Modal (unchanged) -->
  <div class="stripe-modal-overlay" id="stripeModal">
    <div class="stripe-checkout">
      <div id="checkoutFormState">
        <div class="stripe-header">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-content-center overflow-hidden">
                <img src="https://res.cloudinary.com/ded9cb1wd/image/upload/v1767813427/PU_Logo_Blue_White_rwkqvn.png" alt="Logo" class="w-8 h-8 object-contain m-auto">
              </div>
              <div>
                <div class="font-semibold">University of Phuckery</div>
                <div class="text-sm opacity-80" id="modalProductName">Digital Download</div>
              </div>
            </div>
            <button onclick="closeModal()" class="w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center transition-all">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
          </div>
          <div class="text-3xl font-bold" id="modalPrice">$19.99</div>
        </div>
        
        <div class="p-6">
          <div class="demo-banner">
            <div class="demo-banner-icon">!</div>
            <div class="text-sm text-amber-800">
              <strong>Demo Mode:</strong> This is a mockup. No real payment will be processed.
            </div>
          </div>
          
          <form id="mockCheckoutForm" class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1.5">Email</label>
              <input type="email" class="stripe-input" placeholder="you@example.com" value="demo@example.com">
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1.5">Card information</label>
              <div class="card-element">
                <input type="text" class="stripe-input pr-28" placeholder="1234 1234 1234 1234" value="4242 4242 4242 4242" maxlength="19">
                <div class="card-icons">
                  <div class="card-icon" style="background: #1a1f71; color: white;">VISA</div>
                  <div class="card-icon">MC</div>
                  <div class="card-icon" style="background: #006fcf; color: white;">AMEX</div>
                </div>
              </div>
              <div class="grid grid-cols-2 gap-3 mt-3">
                <input type="text" class="stripe-input" placeholder="MM / YY" value="12 / 28" maxlength="7">
                <input type="text" class="stripe-input" placeholder="CVC" value="123" maxlength="4">
              </div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1.5">Name on card</label>
              <input type="text" class="stripe-input" placeholder="Full name on card" id="cardholderName">
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1.5">Country or region</label>
              <select class="stripe-input">
                <option>United States</option>
                <option selected>Canada</option>
                <option>United Kingdom</option>
                <option>Australia</option>
              </select>
              <input type="text" class="stripe-input mt-3" placeholder="ZIP / Postal code" value="V6B 1A1">
            </div>
            
            <button type="submit" class="stripe-btn" id="payBtn">
              Pay <span id="payBtnPrice">$19.99</span>
            </button>
            
            <div class="flex items-center justify-center gap-2 text-xs text-gray-400 pt-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
              <span>Powered by <strong class="text-gray-600">Stripe</strong></span>
            </div>
          </form>
        </div>
      </div>
      
      <div id="successState" class="hidden">
        <div class="success-state">
          <div class="success-checkmark">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
          </div>
          <h3 class="text-2xl font-bold text-gray-900 mb-2">Payment Successful!</h3>
          <p class="text-gray-600 mb-6">Thank you for your order. Your diploma is being prepared.</p>
          
          <div class="bg-gray-50 rounded-lg p-4 mb-6 text-left">
            <div class="text-sm text-gray-500 mb-1">Order confirmation</div>
            <div class="font-mono text-lg font-semibold text-gray-900" id="orderNumber">PHU-2025-XXXXX</div>
          </div>
          
          <div class="text-sm text-gray-500 mb-6">
            A confirmation email has been sent to<br>
            <strong class="text-gray-700">demo@example.com</strong>
          </div>
          
          <button onclick="closeModal()" class="stripe-btn">Done</button>
          
          <div class="demo-banner mt-4">
            <div class="demo-banner-icon">!</div>
            <div class="text-sm text-amber-800">
              <strong>Demo:</strong> In production, this would send a real confirmation email and process the order.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===========================================
    // CONFIGURATION
    // ===========================================
    const CONFIG = {
      // Set to 'mock' for development, 'production' when Canva API is ready
      MODE: 'mock', // 'mock' | 'production'
      
      API_BASE_URL: '/api',
      MASTER_TEMPLATE_ID: 'DAG-EMGuJqg',
    };

    // ===========================================
    // STATE MANAGEMENT
    // ===========================================
    let state = {
      currentStyle: 'classic',
      currentPage: 1,
      previewGenerated: false,
      formDirty: false,
      currentDesignCopyId: null, // Stores the ID of the user's design copy
      isGenerating: false,
    };

    // ===========================================
    // DOM ELEMENTS
    // ===========================================
    const elements = {
      previewBtn: document.getElementById('previewBtn'),
      checkoutBtn: document.getElementById('checkoutBtn'),
      previewContainer: document.getElementById('previewContainer'),
      previewEmpty: document.getElementById('previewEmpty'),
      previewLoading: document.getElementById('previewLoading'),
      previewImage: document.getElementById('previewImage'),
      previewError: document.getElementById('previewError'),
      previewErrorMessage: document.getElementById('previewErrorMessage'),
      previewHint: document.getElementById('previewHint'),
      achievementSelect: document.getElementById('achievementSelect'),
      achievementCustom: document.getElementById('achievementCustom'),
    };

    // ===========================================
    // FORM DATA HELPERS
    // ===========================================
    function getFormData() {
      const firstName = document.getElementById('firstName').value.trim();
      const lastName = document.getElementById('lastName').value.trim();
      const degreeLevel = document.getElementById('degreeLevel').value;
      const faculty = document.getElementById('faculty').value;
      
      let achievement;
      if (elements.achievementSelect.value === 'custom') {
        achievement = elements.achievementCustom.value.trim() || 'being absolutely amazing';
      } else {
        achievement = elements.achievementSelect.value;
      }
      
      // Build degree title
      let degreeTitle;
      if (degreeLevel === 'Bachelor') degreeTitle = `Bachelor of ${faculty}`;
      else if (degreeLevel === 'Master') degreeTitle = `Master of ${faculty}`;
      else degreeTitle = `PhD in ${faculty}`;
      
      return {
        recipientName: `${firstName} ${lastName}`,
        degreeTitle: degreeTitle,
        achievementText: `in recognition of ${achievement}, with all the honors, rights and privileges belonging thereto.`,
        pageNumber: state.currentPage,
      };
    }

    // ===========================================
    // UI STATE MANAGEMENT
    // ===========================================
    function setPreviewState(stateName, errorMessage = '') {
      // Hide all states
      elements.previewEmpty.classList.add('hidden');
      elements.previewLoading.classList.add('hidden');
      elements.previewImage.classList.add('hidden');
      elements.previewError.classList.add('hidden');
      
      // Show requested state
      switch (stateName) {
        case 'empty':
          elements.previewEmpty.classList.remove('hidden');
          break;
        case 'loading':
          elements.previewLoading.classList.remove('hidden');
          break;
        case 'success':
          elements.previewImage.classList.remove('hidden');
          break;
        case 'error':
          elements.previewError.classList.remove('hidden');
          elements.previewErrorMessage.textContent = errorMessage;
          break;
      }
    }

    function setFormDirty(isDirty) {
      state.formDirty = isDirty;
      if (isDirty && state.previewGenerated) {
        elements.previewContainer.classList.add('form-dirty');
      } else {
        elements.previewContainer.classList.remove('form-dirty');
      }
    }

    function updateCheckoutButton() {
      const selected = document.querySelector('input[name="priceTier"]:checked');
      const price = selected.dataset.price;
      elements.checkoutBtn.textContent = `Purchase for $${price}`;
      
      // Enable checkout only if preview has been generated and form is not dirty
      if (state.previewGenerated && !state.formDirty) {
        elements.checkoutBtn.disabled = false;
        elements.previewHint.classList.add('hidden');
      } else {
        elements.checkoutBtn.disabled = true;
        elements.previewHint.classList.remove('hidden');
        if (state.formDirty) {
          elements.previewHint.textContent = 'Preview is outdated - regenerate before purchasing';
        } else {
          elements.previewHint.textContent = 'Generate a preview before purchasing';
        }
      }
    }

    // ===========================================
    // PREVIEW GENERATION (API CALL)
    // ===========================================
    async function generatePreview() {
      if (state.isGenerating) return;
      
      state.isGenerating = true;
      elements.previewBtn.disabled = true;
      elements.previewBtn.classList.add('loading');
      setPreviewState('loading');
      
      const formData = getFormData();
      
      try {
        const response = await fetch(`${CONFIG.API_BASE_URL}/preview`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            templateId: CONFIG.MASTER_TEMPLATE_ID,
            pageNumber: formData.pageNumber,
            fields: {
              '{{RECIPIENT_NAME}}': formData.recipientName,
              '{{DEGREE_TITLE}}': formData.degreeTitle,
              '{{ACHIEVEMENT_TEXT}}': formData.achievementText,
            },
          }),
        });
        
        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.message || 'Failed to generate preview');
        }
        
        const data = await response.json();
        
        // Store the design copy ID for checkout
        state.currentDesignCopyId = data.designId;
        
        // Display the thumbnail
        elements.previewImage.src = data.thumbnailUrl;
        elements.previewImage.onload = () => {
          setPreviewState('success');
          state.previewGenerated = true;
          setFormDirty(false);
          updateCheckoutButton();
        };
        elements.previewImage.onerror = () => {
          throw new Error('Failed to load preview image');
        };
        
      } catch (error) {
        console.error('Preview generation error:', error);
        setPreviewState('error', error.message);
      } finally {
        state.isGenerating = false;
        elements.previewBtn.disabled = false;
        elements.previewBtn.classList.remove('loading');
      }
    }

    // ===========================================
    // MOCK PREVIEW (for development without backend)
    // ===========================================
    async function generatePreviewMock() {
      if (state.isGenerating) return;
      
      state.isGenerating = true;
      elements.previewBtn.disabled = true;
      elements.previewBtn.classList.add('loading');
      setPreviewState('loading');
      
      // Simulate API delay
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      try {
        // Use a placeholder image for now
        // In production, this would be the Canva thumbnail URL
        const mockThumbnails = {
          1: 'https://via.placeholder.com/1000x775/f8f6f0/333333?text=Classic+Academia+Preview',
          2: 'https://via.placeholder.com/1000x775/fffdf7/8B6914?text=Boujie+%26+Luxe+Preview',
          3: 'https://via.placeholder.com/1000x775/f8f6f0/333333?text=Law+School+Preview',
          4: 'https://via.placeholder.com/1000x775/f8f6f0/333333?text=Medical+Preview',
          5: 'https://via.placeholder.com/1000x775/f8f6f0/333333?text=Creatives+Preview',
          6: 'https://via.placeholder.com/1000x775/f8f6f0/8B0000?text=AI+%2F+Tech+Preview',
          7: 'https://via.placeholder.com/1000x775/fef3c7/db2777?text=Lil+Phuckers+Preview',
        };
        
        state.currentDesignCopyId = 'MOCK_DESIGN_' + Date.now();
        
        elements.previewImage.src = mockThumbnails[state.currentPage];
        elements.previewImage.onload = () => {
          setPreviewState('success');
          state.previewGenerated = true;
          setFormDirty(false);
          updateCheckoutButton();
        };
        
      } catch (error) {
        console.error('Preview generation error:', error);
        setPreviewState('error', error.message);
      } finally {
        state.isGenerating = false;
        elements.previewBtn.disabled = false;
        elements.previewBtn.classList.remove('loading');
      }
    }

    // ===========================================
    // EVENT LISTENERS
    // ===========================================
    
    // Preview button
    elements.previewBtn.addEventListener('click', () => {
      if (CONFIG.MODE === 'production') {
        generatePreview();
      } else {
        generatePreviewMock();
      }
    });
    
    // Achievement select toggle
    elements.achievementSelect.addEventListener('change', function() {
      if (this.value === 'custom') {
        elements.achievementCustom.classList.remove('hidden');
        elements.achievementCustom.focus();
      } else {
        elements.achievementCustom.classList.add('hidden');
      }
      setFormDirty(true);
      updateCheckoutButton();
    });
    
    // Mark form dirty on any input change
    document.querySelectorAll('.form-input').forEach(input => {
      input.addEventListener('input', () => {
        setFormDirty(true);
        updateCheckoutButton();
      });
      input.addEventListener('change', () => {
        setFormDirty(true);
        updateCheckoutButton();
      });
    });
    
    // Style buttons
    document.querySelectorAll('.style-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.style-btn').forEach(b => {
          b.classList.remove('active');
          b.style.background = 'white';
          b.style.color = '#6b7280';
          b.style.borderColor = '#e5e7eb';
        });
        this.classList.add('active');
        state.currentStyle = this.dataset.style;
        state.currentPage = parseInt(this.dataset.page);
        setFormDirty(true);
        updateCheckoutButton();
      });
    });
    
    // Price tier changes
    document.querySelectorAll('input[name="priceTier"]').forEach(input => {
      input.addEventListener('change', updateCheckoutButton);
    });

    // ===========================================
    // STRIPE CHECKOUT (unchanged from original)
    // ===========================================
    const stripeModal = document.getElementById('stripeModal');
    const checkoutFormState = document.getElementById('checkoutFormState');
    const successState = document.getElementById('successState');
    const mockCheckoutForm = document.getElementById('mockCheckoutForm');

    function openModal() {
      const selected = document.querySelector('input[name="priceTier"]:checked');
      const price = selected.dataset.price;
      const label = selected.dataset.label;
      
      document.getElementById('modalProductName').textContent = label;
      document.getElementById('modalPrice').textContent = `$${price}`;
      document.getElementById('payBtnPrice').textContent = `$${price}`;
      
      const firstName = document.getElementById('firstName').value;
      const lastName = document.getElementById('lastName').value;
      document.getElementById('cardholderName').value = `${firstName} ${lastName}`;
      
      checkoutFormState.classList.remove('hidden');
      successState.classList.add('hidden');
      
      stripeModal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      stripeModal.classList.remove('active');
      document.body.style.overflow = '';
    }

    function generateOrderNumber() {
      const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
      let result = 'PHU-2025-';
      for (let i = 0; i < 5; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return result;
    }

    elements.checkoutBtn.addEventListener('click', openModal);

    mockCheckoutForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const payBtn = document.getElementById('payBtn');
      payBtn.disabled = true;
      payBtn.classList.add('processing');
      
      setTimeout(() => {
        document.getElementById('orderNumber').textContent = generateOrderNumber();
        checkoutFormState.classList.add('hidden');
        successState.classList.remove('hidden');
        payBtn.disabled = false;
        payBtn.classList.remove('processing');
      }, 2000);
    });

    stripeModal.addEventListener('click', function(e) {
      if (e.target === stripeModal) closeModal();
    });

    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && stripeModal.classList.contains('active')) closeModal();
    });

    // ===========================================
    // INITIALIZATION
    // ===========================================
    updateCheckoutButton();
  </script>
</body>
</html>
